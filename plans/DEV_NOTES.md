# Development Process Notes

## Frameworks

I'm going to use NextJS and use the App router. I will use tailwindCSS and typescript. This is my first project using typescript.

- NextJS (App router)
- TailwindCSS
- TypeScript

## Session 1: getting markdown preview working SUCCESSFUL

Session time: aprox 3 hrs.

File: `ui/create-form.tsx`

Getting markdown preview working. How?

1. I need a Form component with a textarea for writing the markdown. It will need more inputs too, eg. Title, but I want to get a basic version working first.

2. I need a Preview component that shows the rendered markdown. This component needs to receive the text from the textarea.

To start with I'll do it all in one file to keep it simple while experimenting.

### I'm going to try the `marked` with `highlight.js`

The code below works. What it does:

1. It takes the markdown string that is input into the `textarea`, which is managed with `useState`.
2. The html is generated by passing the markdown to `marked`.
3. The html is sanitized using `dompurify`.
4. Syntax highlighting for code blocks is added using `marked-highlight` and `highlight`. This adds the class names so the hightlight stylesheet can be applied. It gets the language from the markdown code block (after the opening backticks).

#### Fixing typescript warnings

The `createMarkup` function was expecting a string but getting a promise. Use async/await with marked, this must be done in a useEffect.

Dompurify needed the type declerations, install with (dev dependency): `yarn add --dev @types/dompurify`

#### Code: Markdown preview

```tsx
"use client";

import { Marked } from "marked";
import { markedHighlight } from "marked-highlight";
import hljs from "highlight.js";
import "highlight.js/styles/atom-one-dark.css";
import DOMPurify from "dompurify";
import { useState, useEffect } from "react";

const marked = new Marked(
  markedHighlight({
    langPrefix: "hljs language-",
    highlight(code, lang, info) {
      const language = hljs.getLanguage(lang) ? lang : "plaintext";
      return hljs.highlight(code, { language }).value;
    },
  })
);

export default function Form() {
  const [markdownContent, setMarkdownContent] = useState("");
  const [htmlContent, setHtmlContent] = useState<string | null>(null);

  useEffect(() => {
    async function convertMarkdownToHtml() {
      const parsedMarkdown = await marked.parse(markdownContent);
      const sanitizedHtml = DOMPurify.sanitize(parsedMarkdown);
      setHtmlContent(sanitizedHtml);
    }

    convertMarkdownToHtml();
  }, [markdownContent]);

  const createMarkup = (content: string) => {
    return { __html: content };
  };

  return (
    <div>
      <form>
        <textarea
          onChange={(e) => setMarkdownContent(e.target.value)}
          name=""
          id=""
          cols={30}
          rows={10}
          value={markdownContent}
        ></textarea>
      </form>

      {htmlContent && (
        <div dangerouslySetInnerHTML={createMarkup(htmlContent)}></div>
      )}
    </div>
  );
}
```

## Session 2: setup database and CRUD routes

TODO: setup vercel

- create github repo (needed to host on vercel)
- setup vercel hosting
- setup vercel database

TODO: CRUD routes

- CREATE post: save the new post in the DB
- READ post: see all posts, convert the markdown to html on server
- EDIT post:
- DELETE post:

NOTE: I will have to revise the nextjs-dashboard tutorial to see how to do this. I think I'll need to use `actions`, these allow you to do server stuff in a `client` component.
